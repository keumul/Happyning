generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id       Int       @id @default(autoincrement())
  username String    @unique
  password String
  surname  String?
  bday     DateTime  @db.Date
  email    String    @unique
  isAdmin  Boolean?  @default(false)

  createdAt DateTime @default(now())
  updateAt  DateTime @updatedAt

  event              Event[]
  photo              Photo[]
  eventRating        EventRating[]
  eventRegistrations EventRegistrations[]
  raterUser          UserRating[]         @relation("RaterRelation")
  ratedUser          UserRating[]         @relation("RatedRelation")
  notification       Notification[]
  message            Message[]

  @@map("users")
}

model Event {
  id             Int      @id @default(autoincrement())
  title          String
  startDate      DateTime
  description    String?
  maxGuestAmount Int?
  isPublic       Boolean? @default(false)
  location       String

  createdAt      DateTime @default(now())
  updateAt       DateTime @updatedAt

  organizerId    Int
  organizer      User @relation(fields: [organizerId], references: [id])

  categoryId     Int
  category       Category @relation(fields: [categoryId], references: [id])

  eventRating        EventRating[]
  eventRegistrations EventRegistrations[]
  notification       Notification[]
  album              Album[]
  message            Message[]

  @@map("events")
}

model EventRating {
  id        Int     @id @default(autoincrement())
  message   String?
  rate      Float   @default(0.0)

  eventId   Int
  event     Event @relation(fields: [eventId], references: [id])

  userId    Int
  user      User @relation(fields: [userId], references: [id])

  @@map("events_rating")
}

model UserRating {
  id          Int     @id @default(autoincrement())
  message     String?
  rate        Float   @default(5.0)

  raterId     Int
  rater       User @relation(name: "RaterRelation", fields: [raterId], references: [id])

  ratedId     Int
  rated       User @relation(name: "RatedRelation", fields: [ratedId], references: [id])

  @@map("users_rating")
}

model EventRegistrations {
  id          Int @id @default(autoincrement())
  guestAmount Int @default(0)

  createdAt   DateTime @default(now())

  eventId     Int
  event       Event @relation(fields: [eventId], references: [id])

  userId      Int
  user        User @relation(fields: [userId], references: [id])

  @@map("events_registrations")
}

model Message {
  id          Int    @id @default(autoincrement())
  message     String

  createdAt   DateTime @default(now())
  updateAt    DateTime @updatedAt

  eventId     Int
  event       Event @relation(fields: [eventId], references: [id])

  userId      Int
  user        User @relation(fields: [userId], references: [id])

  @@map("messages")
}

model Notification {
  id          Int      @id @default(autoincrement())
  message     String
  isRead      Boolean? @default(false)
  qrCode      String?

  createdAt   DateTime @default(now())
  updateAt    DateTime @updatedAt

  userId      Int
  user        User @relation(fields: [userId], references: [id])

  eventId     Int
  event       Event @relation(fields: [eventId], references: [id])

  @@map("notifications")
}

model Category {
  id          Int     @id @default(autoincrement())
  title       String
  description String?

  event       Event[]

  @@map("categories")
}

model Album {
  id          Int    @id @default(autoincrement())
  title       String

  eventId     Int
  event       Event @relation(fields: [eventId], references: [id])

  photo       Photo[]

  @@map("albums")
}

model Photo {
  id            Int   @id @default(autoincrement())
  photo         Bytes

  createdAt     DateTime @default(now())
  updateAt      DateTime @updatedAt

  albumId       Int
  album         Album @relation(fields: [albumId], references: [id])

  userId        Int
  user          User @relation(fields: [userId], references: [id])

  @@map("photos")
}
